!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("rxjs/operators"),require("lodash"),require("@angular/core"),require("rxjs"),require("@angular/common"),require("@angular/http"),require("@angular/platform-browser"),require("@angular/platform-browser/animations"),require("@angular/material"),require("@ngu/carousel")):"function"==typeof define&&define.amd?define("fishry",["exports","rxjs/operators","lodash","@angular/core","rxjs","@angular/common","@angular/http","@angular/platform-browser","@angular/platform-browser/animations","@angular/material","@ngu/carousel"],e):e(t.fishry={},t.rxjs.operators,t.lodash,t.ng.core,t.rxjs,t.ng.common,t.ng.http,t.ng.platformBrowser,t.ng.platformBrowser.animations,t.ng.material,t["@ngu/carousel"])}(this,function(t,i,r,n,s,o,e,a,u,l,c){"use strict";var p=function(){return(p=Object.assign||function(t){for(var e,n=1,i=arguments.length;n<i;n++)for(var r in e=arguments[n])Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t}).apply(this,arguments)},h=function P(t,e){this.type=t,this.payload=e},g="UPDATE",m="DELETE",d=function T(t){this.payload=t,this.type="SET"},f=function L(t){this.payload=t,this.type="UPDATE"},y=function R(t){this.payload=t,this.type="DELETE"},b=function(){function t(t){var e=this;this.platformId=t,this.actions=new s.Subject,this._state$=new s.BehaviorSubject(this.initialState),this.actions.pipe(i.scan(function(t,e){var n;switch(e.type){case"SET":n=e.payload;break;case g:n=p({},t,e.payload);break;case m:n=r.omit(t,e.payload);break;default:n=t}return n},{}),i.shareReplay(1)).subscribe(function(t){return e._state$.next(t)}),o.isPlatformBrowser(this.platformId)}return t.prototype.select$=function(t){return this.state$.pipe(S(t))},t.prototype.select=function(t){return this.state$.pipe(S(t)).toPromise()},t.prototype.dispatch=function(t){this.actions.next(t)},Object.defineProperty(t.prototype,"state",{get:function(){return this._state$.getValue()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"state$",{get:function(){return this._state$.asObservable()},enumerable:!0,configurable:!0}),t.prototype.setState=function(t){this._state$.next(t)},t.decorators=[{type:n.Injectable,args:[{providedIn:"root"}]}],t.ctorParameters=function(){return[{type:Object,decorators:[{type:n.Inject,args:[n.PLATFORM_ID]}]}]},t.ngInjectableDef=n.defineInjectable({factory:function(){return new t(n.inject(n.PLATFORM_ID))},token:t,providedIn:"root"}),t}(),S=function(e){return s.pipe(i.map(function(t){return r.get(t,e,null)}),i.distinctUntilChanged(r.isEqual))},v=a.makeStateKey("appState"),x=function(){function t(t,e,n,i,r){this.domain=t,this.http=e,this.store=n,this.platformId=i,this.state=r,this.appState={isLoaded:!1,generalSettings:null,themeSettings:null,navigation:null,storeSettings:null,storeID:null,domain:null,isPlatformBrowser:!1},this.redisUrl="https://fishry-storefront-stg-ngx.azurewebsites.net",this.initDomain(t),this.appState=this.state.get(v,null),this.appState?(console.log("appState alrady set"),this.store.dispatch(new h("SET",{isLoaded:this.appState.isLoaded,generalSettings:this.appState.generalSettings,themeSettings:this.appState.themeSettings,navigation:this.appState.navigation,storeSettings:this.appState.storeSettings,storeID:this.appState.storeID,domain:this.appState.domain,isPlatformBrowser:!1})),console.log("the state",this.store.state)):(console.log("appState not set"),this.initGeneralSettings(t).subscribe())}return t.prototype.initDomain=function(t){this.store.dispatch(new h("SET",{domain:t}))},t.prototype.initGeneralSettings=function(t){var n=this;return this.fetchGeneralSettings(this.domain).pipe(i.catchError(function(t){return s.throwError(t)}),i.tap(function(t){console.log("result",t),n.store.dispatch(new h("UPDATE",{generalSettings:t})),n.initThemeSettings(t.theme_settings),n.initStoreID(t.storeID),n.initStoreSettings(t.settings),n.initNavigation(t.nav_data),n.store.dispatch(new h("UPDATE",{isLoaded:!0}));var e={isLoaded:n.store.state.isLoaded,generalSettings:n.store.state.generalSettings,themeSettings:n.store.state.themeSettings,navigation:n.store.state.navigation,storeSettings:n.store.state.storeSettings,storeID:n.store.state.storeID,domain:n.store.state.domain,isPlatformBrowser:!1};n.state.set(v,e)},function(t){return console.error("error",t.message)}))},t.prototype.initThemeSettings=function(t){var e=(t=JSON.parse(t)).mainBanner;e=Object.keys(e).map(function(t){return e[t]}),t.mainBanner=e,this.store.dispatch(new h("UPDATE",{themeSettings:t}))},t.prototype.fixThemeSettingsData=function(t){var e=t.mainBanner;e=Object.keys(e).map(function(t){return e[t]}),t.mainBanner=e},t.prototype.initStoreID=function(t){this.store.dispatch(new h("UPDATE",{storeID:t}))},t.prototype.initStoreSettings=function(t){t=JSON.parse(t),this.store.dispatch(new h("UPDATE",{storeSettings:t}))},t.prototype.initNavigation=function(t){this.store.dispatch(new h("UPDATE",{navigation:t}))},t.prototype.fetchGeneralSettings=function(t){return this.http.get(this.redisUrl+"/get-store-info?domain="+t).pipe(i.map(function(t){return t.json().data}),i.share())},t.decorators=[{type:n.Injectable,args:[{providedIn:"root"}]}],t.ctorParameters=function(){return[{type:String,decorators:[{type:n.Inject,args:["domain"]}]},{type:e.Http},{type:b},{type:Object,decorators:[{type:n.Inject,args:[n.PLATFORM_ID]}]},{type:a.TransferState}]},t.ngInjectableDef=n.defineInjectable({factory:function(){return new t(n.inject("domain"),n.inject(e.Http),n.inject(b),n.inject(n.PLATFORM_ID),n.inject(a.TransferState))},token:t,providedIn:"root"}),t}(),I=function(){function t(){}return t.prototype.ngOnInit=function(){},t.decorators=[{type:n.Component,args:[{selector:"fishry-fishry",template:"\n    <p>\n      fishry works!\n    </p>\n  "}]}],t.ctorParameters=function(){return[]},t}(),E=function(){function t(t){this.platformId=t,this.src="",this.route="product",this.size="",this.enableLazyLoad=!0,this.highResReady=!1,this.cdn="https://fishry-image.azureedge.net/"}return t.prototype.ngOnInit=function(){o.isPlatformBrowser(this.platformId)&&(this.highRes=new Image,this.activeLoad(),this.enableLazyLoad&&this.lazyLoad())},t.prototype.activeLoad=function(){var t=this;this.img.nativeElement.onerror=function(){t.src?t.img.nativeElement.src=""+t.cdn+t.route+"/"+t.src:t.img.nativeElement.onerror=null},this.src&&(this.enableLazyLoad&&"xxxs"!==this.size?this.img.nativeElement.src=""+this.cdn+this.route+"/"+this.src+"/xxs":this.size?this.img.nativeElement.src=""+this.cdn+this.route+"/"+this.src+"/"+this.size:this.img.nativeElement.src=""+this.cdn+this.route+"/"+this.src)},t.prototype.lazyLoad=function(){var t=this;""===this.size?this.highRes.src=""+this.cdn+this.route+"/"+this.src:this.highRes.src=""+this.cdn+this.route+"/"+this.src+"/"+this.size,this.highRes.onload=function(){t.highResReady=!0,t.img.nativeElement.src=t.highRes.src},this.size&&(this.highRes.onerror=function(){t.img.nativeElement.src=""+t.cdn+t.route+"/"+t.src,t.highRes.onerror=null})},t.prototype.ngAfterViewInit=function(){var t=this;this.img.nativeElement.onload=function(){t.highResReady?t.img.nativeElement.classList.remove("blur-in"):t.img.nativeElement.classList.add("loaded")}},t.decorators=[{type:n.Component,args:[{selector:"fishry-image",template:'<img #img [ngClass]="{\'blur-in\': enableLazyLoad}" class="img-fluid" />',styles:[""]}]}],t.ctorParameters=function(){return[{type:Object,decorators:[{type:n.Inject,args:[n.PLATFORM_ID]}]}]},t.propDecorators={src:[{type:n.Input}],route:[{type:n.Input}],size:[{type:n.Input}],enableLazyLoad:[{type:n.Input}],img:[{type:n.ViewChild,args:["img"]}]},t}(),j=function(){function t(){this.banner=[],this.carouselOne={grid:{xs:1,sm:1,md:1,lg:1,all:0},slide:1,speed:400,point:{visible:!0},load:2,touch:!0,loop:!0,custom:"banner"}}return t.prototype.ngOnInit=function(){},t.decorators=[{type:n.Component,args:[{selector:"fishry-carousel",template:'<ngu-carousel #myCarousel [inputs]="carouselOne" [dataSource]="banner">\n  \x3c!-- <ngu-item *ngFor="let banner of desktopBanner; let i = index" (click)="routeTo(banner.link)">\n    <img [src]="banner.image" alt="" class="img-fluid">\n  </ngu-item>\n  <button NguCarouselPrev class=\'leftRs\'>&lt;</button>\n  <button NguCarouselNext class=\'rightRs\'>&gt;</button> --\x3e\n\n\n  <ngu-tile *nguCarouselDef="let item; let j = index">\n    \x3c!-- <div class="tile" [style.background]="\'url(\' + item + \')\'">\n      <h1>{{j}}</h1>\n    </div> --\x3e\n    <img [src]="item.image" alt="" class="img-fluid">\n  </ngu-tile>\n  <button NguCarouselPrev class="leftRs">&lt;</button>\n  <button NguCarouselNext class="rightRs">&gt;</button>\n  \x3c!-- <ul class="myPoint" NguCarouselPoint>\n    <li *ngFor="let j of myCarousel.pointNumbers; let j = index" [class.active]="j==myCarousel.activePoint" (click)="myCarousel.moveTo(j)"\n      [style.background]="\'url(\' + images[j] + \')\'"></li>\n  </ul> --\x3e\n</ngu-carousel>',styles:[".leftRs{position:absolute;margin:auto;top:0;bottom:0;width:50px;height:50px;box-shadow:1px 2px 10px -1px rgba(0,0,0,.3);border-radius:999px;left:0}.rightRs{position:absolute;margin:auto;top:0;bottom:0;width:50px;height:50px;box-shadow:1px 2px 10px -1px rgba(0,0,0,.3);border-radius:999px;right:0}"]}]}],t.ctorParameters=function(){return[]},t.propDecorators={banner:[{type:n.Input}]},t}(),w=function(){function t(){}return t.prototype.ngOnInit=function(){},t.prototype.listExists=function(t){return!!(t.list&&0<t.list.length)},t.prototype.listEmpty=function(t){return!(!t.list||0!=t.list.length)},t.decorators=[{type:n.Component,args:[{selector:"fishry-nav",template:'<div class="navigation-block" class="row">\n  <div class="d-inline-block" *ngFor="let item of menuItems">\n    <button *ngIf="listExists(item)" mat-button [matMenuTriggerFor]="subMenu1">\n      {{item.name}}\n    </button>\n    <button *ngIf="listEmpty(item)" mat-button>\n      {{item.name}}\n    </button>\n    <mat-menu #subMenu1="matMenu">\n      <div *ngFor="let list of item.list">\n        <button mat-menu-item *ngIf="listEmpty(list)">{{list.name}}</button>\n        <button *ngIf="listExists(list)" mat-menu-item [matMenuTriggerFor]="subMenu">{{list.name}}</button>\n        <mat-menu #subMenu="matMenu">\n          <button mat-menu-item *ngFor="let list of list.list">{{list.name}}</button>\n        </mat-menu>\n      </div>\n    </mat-menu>\n  </div>\n</div>',styles:[""]}]}],t.ctorParameters=function(){return[]},t.propDecorators={menuItems:[{type:n.Input}]},t}(),D=function(){function e(){}return e.forRoot=function(t){return{ngModule:e,providers:[x,{provide:"domain",useValue:t}]}},e.decorators=[{type:n.NgModule,args:[{imports:[o.CommonModule,u.BrowserAnimationsModule,l.MatMenuModule,l.MatButtonModule,c.NguCarouselModule],declarations:[I,E,j,w],exports:[I,E,j,w]}]}],e}();t.FishryService=x,t.FishryComponent=I,t.FishryModule=D,t.FishryStore=b,t.select=S,t.Action=h,t.SET="SET",t.UPDATE=g,t.DELETE=m,t.setTest=d,t.updateTest=f,t.deleteTest=y,t.ɵb=j,t.ɵa=E,t.ɵc=w,Object.defineProperty(t,"__esModule",{value:!0})});
//# sourceMappingURL=fishry.umd.min.js.map